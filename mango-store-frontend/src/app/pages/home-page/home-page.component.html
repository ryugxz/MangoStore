<div class="p-3 w-full flex flex-column align-items-center justify-content-center">
  <!-- Search and Refresh -->
  <div class="flex justify-content-center align-items-center mb-4 gap-3 w-full max-w-6xl p-3">
    <span class="p-input-icon-left w-50">
      <i class="pi pi-search"></i>
      <input 
        type="text" 
        pInputText 
        [(ngModel)]="searchValue" 
        (input)="onSearchInputChange()" 
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" 
        class="w-full"
      />
    </span>
    <button pButton type="button" icon="pi pi-refresh" style="min-width:50px; height:50px;" class="p-button-outlined custom-button" (click)="refreshProducts()"></button>
  </div>

  <div class="hr-with-icon w-full">
    <hr>
    <span class="icon">üçã</span> <!-- ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
    <span class="icon">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span> <!-- ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
    <span class="icon">üçã</span> <!-- ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
    <hr>
  </div>

  <!-- No Products Message -->
  <div *ngIf="products.length === 0" class="flex justify-content-center align-items-center text-center w-full h-full">
    ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
  </div>

  <!-- Products Grid -->
  <div *ngIf="products.length > 0" class="grid w-full max-w-6xl p-3">
    <div *ngFor="let product of displayedProducts" class="col-12 sm:col-6 md:col-4 lg:col-3">
      <p-card [header]="product.name" class="h-full">
        <ng-template pTemplate="header">
          <div class="image-wrapper">
            <p-image
              styleClass="{height:100% !important;}"
              [src]="product.images[0]?.image_data || '../../assets/images/no-image.png'" 
              alt="Card" 
              [preview]="true">
            </p-image>
          </div>
        </ng-template>
        <div class="flex justify-content-between align-items-center mt-2">
          <h3 class="m-0"><span class="text-teal-500">{{product.price}}</span> ‡∏ö‡∏≤‡∏ó</h3>
        </div>
        <ng-template pTemplate="footer">
          <div class="flex flex-column gap-2 mt-2">
            <p-button 
              label="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" 
              styleClass="infoButton"
              icon="pi pi-info-circle" 
              severity="info" 
              class="w-full p-button-sm" 
              [style]="{ width: '100%' }"
              (click)="showProductDetails(product)"
            />
            <p-button 
              label="‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤" 
              styleClass="addButton"
              icon="pi pi-shopping-cart" 
              severity="success" 
              class="w-full p-button-sm" 
              (click)="addToCart(product)" 
              [style]="{ width: '100%' }"
              [disabled]="userRole && userRole !== 'customer'"
            />
          </div>                      
        </ng-template>
      </p-card>
    </div>
  </div>

  <div class="hr-with-icon w-full">
    <hr>
    <span class="icon">üçã</span> <!-- ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ -->
    <hr>
  </div>
  

  <!-- Pagination -->
  <p-paginator 
    *ngIf="products.length > 0" 
    [rows]="productsPerPage" 
    [totalRecords]="products.length" 
    (onPageChange)="onPageChange($event)" 
    class="mt-4 p-3">
  </p-paginator>

<!-- Product Details Dialog -->
<!-- Product Details Dialog -->
<p-dialog header="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" [(visible)]="displayDialog" [modal]="true" [closable]="true" [responsive]="true" [breakpoints]="{'960px': '75vw', '640px': '90vw'}" [style]="{width: '40vw'}">
  <ng-template pTemplate="content">
    <div *ngIf="selectedProduct">
      <h2>{{ selectedProduct.name }}</h2>
      <hr class="section-divider">
      
      <div *ngFor="let image of selectedProduct.images" class="flex justify-content-center mb-2 p-3">
        <p-image [src]="image.image_data" alt="Product Image" width="400"></p-image>
      </div>
      
      <hr class="section-divider">

      <p>{{ selectedProduct.description }}</p>
      
      <hr class="section-divider">
      
      <div *ngIf="selectedProduct.promotion" class="promotion-details p-2 w-full">
        <h3 class="text-red-500">‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: {{ selectedProduct.promotion.promotion_type }}</h3>
        <p>‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤: <span class="text-red-500">{{ selectedProduct.promotion.discount_value }}%</span></p>
        <p>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: {{ selectedProduct.promotion.start_date | date:'dd/MM/yyyy' }} - {{ selectedProduct.promotion.end_date | date:'dd/MM/yyyy' }}</p>
        <p *ngIf="selectedProduct.promotion.description">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô: {{ selectedProduct.promotion.description }}</p>
        <hr class="section-divider">
      </div>
      
      <div class="flex justify-content-end w-full">
        <h3 class="align-self-end">‡∏£‡∏≤‡∏Ñ‡∏≤ <span class="text-teal-500">{{ selectedProduct.price }}</span> ‡∏ö‡∏≤‡∏ó</h3>
      </div>        
    </div>
  </ng-template>
</p-dialog>



  <!-- Login Dialog -->
  <p-dialog header="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô" [(visible)]="displayLoginDialog" [modal]="true" [closable]="true" [responsive]="true" [breakpoints]="{'960px': '75vw', '640px': '90vw'}" [style]="{width: '30vw'}">
    <ng-template pTemplate="content">
      <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>
    </ng-template>
    <ng-template pTemplate="footer">
      <p-button label="Close" icon="pi pi-times" (click)="displayLoginDialog = false"></p-button>
    </ng-template>
  </p-dialog>

  <!-- Add to Cart Dialog -->
  <p-dialog header="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤" [(visible)]="displayAddToCartDialog" [modal]="true" [closable]="true" [responsive]="true" [breakpoints]="{'960px': '75vw', '640px': '90vw'}" [style]="{width: '30vw'}">
    <ng-template pTemplate="content">
      <div *ngIf="selectedProduct" class="p-fluid">
        <div class="flex flex-column align-items-center">
          <div class="image-container text-center" style="width: 100%; max-height: 300px; overflow: hidden;">
            <p-image 
              [src]="selectedProduct.images[0]?.image_data || '../../assets/images/no-image.png'" 
              alt="Product Image" 
              width="300">
            </p-image>
          </div>
          <h3 class="mt-2 text-center" style="font-size: 1.2em;">{{ selectedProduct.name }}</h3>
          <h4 class="mt-1">{{ selectedProduct.price }} ‡∏ö‡∏≤‡∏ó</h4>
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ selectedProduct.stock }})</p>
          <p-inputNumber 
            [(ngModel)]="quantity" 
            mode="decimal" 
            [showButtons]="true" 
            inputId="minmax-buttons" 
            [min]="1" 
            [max]="selectedProduct.stock" 
            class="w-full">
          </p-inputNumber>
          <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á:</p>
          <input type="text" pInputText [(ngModel)]="shippingAddress" class="w-full"/>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="footer">
      <div class="flex justify-content-end">
        <p-button label="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" icon="pi pi-check" class="mr-2" (click)="confirmAddToCart()"></p-button>
        <p-button label="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" icon="pi pi-times" (click)="displayAddToCartDialog = false" severity="danger"></p-button>
      </div>
    </ng-template>
  </p-dialog>
</div>
